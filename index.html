<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="bootstrap/favicon.ico">

    <title>Analysis of Things</title>

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <style>
    /*
 * Base structure
 */

/* Move down content because we have a fixed navbar that is 50px tall */
body {
  padding-top: 50px;
}


/*
 * Global add-ons
 */

.sub-header {
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

/*
 * Top navigation
 * Hide default border to remove 1px line.
 */
.navbar-fixed-top {
  border: 0;
}

/*
 * Sidebar
 */

/* Hide for mobile, show later */
.sidebar {
  display: none;
}
@media (min-width: 768px) {
  .sidebar {
    position: fixed;
    top: 51px;
    bottom: 0;
    left: 0;
    z-index: 1000;
    display: block;
    padding: 20px;
    overflow-x: hidden;
    overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
    background-color: #f5f5f5;
    border-right: 1px solid #eee;
  }
}

/* Sidebar navigation */
.nav-sidebar {
  margin-right: -21px; /* 20px padding + 1px border */
  margin-bottom: 20px;
  margin-left: -20px;
}
.nav-sidebar > li > a {
  padding-right: 20px;
  padding-left: 20px;
}
.nav-sidebar > .active > a,
.nav-sidebar > .active > a:hover,
.nav-sidebar > .active > a:focus {
  color: #fff;
  background-color: #428bca;
}


/*
 * Main content
 */

.main {
  padding: 20px;
}
@media (min-width: 768px) {
  .main {
    padding-right: 40px;
    padding-left: 40px;
  }
}
.main .page-header {
  margin-top: 0;
}


/*
 * Placeholder dashboard ideas
 */

.placeholders {
  margin-bottom: 30px;
  text-align: center;
}
.placeholders h4 {
  margin-bottom: 0;
}
.placeholder {
  margin-bottom: 20px;
}
.placeholder img {
  display: inline-block;
  border-radius: 50%;
}
    </style>
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Analysis of Things</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a id="notification" onClick="refreshData()">Data is up to date.</a></li>
          </ul>
        </div>
      </div>
      
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4 col-md-2 sidebar">
          <ul class="nav nav-sidebar" id="raspberrypi"<a> Raspberry Pi</a>
            <li id="RPI-WIFI"><a onClick="switchThing('RPI-WIFI')">Wi-Fi</a></li>
            <li id="RPI-BT"><a onClick="switchThing('RPI-BT')">Bluetooth</a></li>
          </ul>
          <ul class="nav nav-sidebar" id="wemo"<a> WEMO </a>
            <li class="" id="wemo-switch"><a onClick="switchThing('WEMO-SWITCH')">Switch</a></li>
            <li class ="" id="wemo-motion"><a onClick="switchThing('WEMO-MOTION')">Motion</a></li>
          </ul>
          <ul class="nav nav-sidebar" id="android"<a> Android </a>
            <li id="android-sms"><a onClick="switchThing('ANDROID-SMS')">SMS</a></li>
            <li id="android-location"><a onClick="switchThing('ANDROID-LOCATION')">Location</a></li>
          </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 class="page-header">Dashboard
          <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Update Interval
            <span class="caret"></span></button>
            <ul class="dropdown-menu" id="choose-speed">
              <li><a href="#">10</a></li>
              <li><a href="#">5</a></li>
              <li><a href="#">2</a></li>
            </ul>
          </div>
          </h1>
          <div class="row placeholders">
            <div class="col-xs-6 placeholder">
               <canvas id="chart1" width="400" height="400"></canvas>
              <h4 id ="chart1-title">Label</h4>
              <span class="text-muted" id="chart1-desc">Something else</span>
            </div>
            <div class="col-xs-6 placeholder">
             <canvas id="chart2" width="400" height="400"></canvas>
              <h4 id ="chart2-title">Label</h4>
              <span class="text-muted" id="chart2-desc">Something else</span>
            </div>
          </div>
          <h2 class="sub-header" id="table-title">Raw Data</h2>
          <div class="table-responsive">
            <table class="table table-striped" id="data-table">
              <thead id="head-table">
                <tr>
                </tr>
              </thead>
              <tbody id="body-table">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.1.0/Chart.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="bootstrap/js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="bootstrap/js/ie10-viewport-bug-workaround.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script>


///////////////////     EXAMPLE DATA        //////////////////////

var wifiData = [];
var bluetoothData = [];
var switchData=[];
var leftGraphData = [];
var rightGraphData;

var colours = ['#FF9058','#FFD958','#53F3BF','#766AF4'];
var colours2= ['#EBB802','#4DCD01','#D70133','#2617A3'];
var data = [
    {
      value: 25,
      label: 'Java',
      color: colours[0]
    },
    {
      value: 10,
      label: 'Scala',
      color: colours[1]
    },
    {
      value: 30,
      label: 'PHP',
      color: colours[2]
    },
    {
      value : 35,
      label: 'HTML',
      color: colours[3]
    },
    {
      value : 35,
      label: 'HTML',
      color: colours2[0]
    },{
      value : 35,
      label: 'HTML',
      color: colours2[1]
    }
    ];
var wifiTestData=[
{
      value: 0.017,
      label: 'Basement',
      color: colours[0]
    },
    {
      value: 0.022,
      label: 'Extend2.4',
      color: colours[1]
    },
    {
      value: 0.012,
      label: 'Bell050',
      color: colours[2]
    }
];
 
var wifiTestData2 = {
    labels: ["11,10,9"],
    datasets: [
        {
            label: "My Other Fake Data",
            fillColor: "rgba(85, 228, 241,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(0, 218, 238,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [3,1,3]
        }
    ]
};

var data2 = {
    labels: ["January", "February", "March", "April", "May", "June", "July"],
    datasets: [
        {
            label: "My Fake Data",
            fillColor: "rgba(85, 228, 241,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(0, 218, 238,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [65, 59, 80, 81, 56, 55, 40]
        }
    ]
};

function accessPoint(ap) {
    this.signal = new Number(ap.signal);
    this.ssid = ap.ssid;
    this.channel = ap.channel;
    this.address = ap.address;
    console.log(this);
}

function bluetoothDevice(bd){
  this.name = bd.name;
  this.address = bd.address;
}

function wemoMotion(wm){
  this.type = wm.type;
  this.status = wm.status;
}

function wemoSwitch(ws){
  this.type = ws.type;
  this.mode =ws.mode;
}

function androidSMS(sms){
  this.type = sms.type;
  this.from =sms.from;
}

function androidLocation(al){
  this.type = al.type;
  this.location =al.location;
}

function simpleData(value,label,color){
  this.value = value;
  this.label = label;
  this.color = color;
}

function complexData(labels,l,d){
  this.labels = labels;
  this.datasets = [{
    label : l,
    fillColor: "rgba(85, 228, 241,0.5)",
    strokeColor: "rgba(220,220,220,0.8)",
    highlightFill: "rgba(0, 218, 238,0.75)",
    highlightStroke: "rgba(220,220,220,1)",
    data : d
  }];
}

//var newData2 = new complexData(["a","b","c","d"],"Speed!",[3,4,5,6]);
//console.log(newData2);

/*labels: ["11"],
    datasets: [
        {
            label: "Channels",
            fillColor: "rgba(85, 228, 241,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(0, 218, 238,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [3]
        }
    ]*/

///////////////////     HTML ELEMENTS       //////////////////////
var chart1 = document.getElementById('chart1').getContext("2d");
var chart2 = document.getElementById('chart2').getContext("2d");



var table = document.getElementById('data-table');

//////////////////         DATA          /////////////////////////

//wifiData
//bluetoothData

//var switchData = [];
var motionData = [];

var smsData = [];
var loactionData = [];

var updateInterval = 1000;
var currentView = "RPI-WIFI";

var ch1 = new Chart(chart1).PolarArea(data);
var ch2 = new Chart(chart2).Bar(data2);


///////////////////     EVENT LISTENERS       //////////////////////
$('#choose-speed li').on('click', function(){
  console.log($(this).text());
  updateInterval = new Number($(this).text());
});

var socket = io();
  socket.on('_post', function(data){
    console.log(data);

    var obj = data;//JSON.parse(data);
    console.log(obj);
    console.log(obj.type + "<---obj   currentView---->" + currentView);
    //if(obj.type == currentView){
      loadData(obj);
    /*}
    else{
      notifyIcon();
    }*/
  });

  socket.on('_load', function(data){
    
  });

///////////////////       FUNCTIONS         //////////////////////

/*var myFunction = function(){
    clearInterval(interval);
    interval = setInterval(myFunction, updateInterval);
    alert("Hi");
}
  var interval = setInterval(myFunction, updateInterval);
*/
function switchThing(option){
    //this
    $( "#overview" ).children().removeClass();
    $( "#raspberrypi" ).children().removeClass();
    $( "#wemo" ).children().removeClass();
    $( "#android" ).children().removeClass();
    $('#' + option).addClass("active");
    currentView = option;
    switch(option){
      case 'RPI-WIFI':loadWifiTable();break;
      case 'RPI-BT':loadBluetoothTable();break;
      case 'WEMO-SWITCH':loadSwitchTable();break;
      case 'ANDROID-SMS':loadSMSTable();break;
    }
  }

function loadData(data){
  /*if($.isEmptyObject(data)){
    console.log("Empty data object");
    return;
  }*/
    console.log(data.type);
  switch(data.type){
    case "RPI-WIFI":      
        //data.rpi_wifi.forEach(iterateWifi);
        wifiData.length = 0;
        $.each(data.devices, function(){
    
        var a = new accessPoint(JSON.parse(this));
        wifiData.push(a);

        });
        if(data.type == currentView){
        loadWifiTable();
        setChartData("Signal Strength","Channels","Measured in dB","Number of Access Points/Channel");
        $('#table-title').text("Wi-Fi Data");
      }
        //load view data with wifi related data
        //load into graphs and table
        //update view
        break;
        case "RPI-BT": 
        //load view data with wifi related data
        //data.rpi_bt.forEach(iterateBluetooth);
        bluetoothData.length = 0;
            $.each(data.devices, function(){
        
        var a = new bluetoothDevice(JSON.parse(this));
        bluetoothData.push(a);

        });
        if(data.type == currentView){
        loadBluetoothTable();
        setChartData("","","","");
        $('#table-title').text("Bluetooth Data");
      }
        //load into graphs and table
        //update view
        break;
        case "WEMO-SWITCH":
        var a = new wemoSwitch(data);
        if(switchData.length<10)
          switchData.push(a);
        else{
          switchData.pop();
          switchData.push(a);
        }

        //load view data with wifi related data
        if(data.type == currentView){
        loadSwitchTable();
        setChartData("Popular Events","Popular Time","Most Frequent Events","Most Frequent Periods of Time");
        $('#table-title').text("WeMo Switch Data");
      }
        //load into graphs and table
        //update view
        break;
        case "wemo-motion": 
        //load view data with wifi related data
        if(data.type == currentView){
        loadMotionTable();
        setChartData("Popular Events","Popular Time","Most Frequent Events","Most Frequent Periods of Time");
        $('#table-title').text("WeMo Motion Data");
      }
        //load into graphs and table
        //update view
        break;
        case "android-location": 
        //load view data with wifi related data
        if(data.type == currentView){
        loadLocationTable();
        setChartData("Popular Locations","Popular Time","Most Frequent Locations","Most Frequent Periods of Time");
        $('#table-title').text("Android Location Data");
      }
        //load into graphs and table
        //update view
        break;
        case "ANDROID-SMS": 
        var a = new androidSMS(data);
        if(smsData.length<10)
          smsData.push(a);
        else{
          smsData.pop();
          smsData.push(a);
        }
        //load view data with wifi related data
        if(data.type == currentView){
        loadSMSTable();
        setChartData("Popular People","Popular Time","Most Frequent People","Most Frequent Periods of Time");
        $('#table-title').text("Android SMS Data");
      }
        //load into graphs and table
        //update view
        break;
        default: break;
      }
    }
 


  function setChartData(title1,title2,desc1,desc2){
    $('#chart1-desc').text(desc1);
    $('#chart2-desc').text(desc2);
    $('#chart1-title').text(title1);
    $('#chart2-title').text(title2);
  }

  function cleanTable(){
    $("#head-table td").remove(); 
    $("#body-table tr").remove(); 
    $("#body-table td").remove();
  }

  function loadWifiTable(){
    cleanTable();
    $('#head-table tr').append('<td>SSID</td>')
    $('#head-table tr').append('<td>Signal Strength</td>')
    $('#head-table tr').append('<td>Channel</td>')
    $('#head-table tr').append('<td>Address</td>')
    leftGraphData.length = 0;
    var rows = "";
    var channels = [];
    var labels = [];
    $.each(wifiData, function(){
    console.log(this);

    leftGraphData.push(new simpleData(-1*new Number(this.signal),this.ssid,colours[0]));
    channels.push(this.channel);
    labels.push(this.ssid);
    rows += "<tr><td>" + this.ssid + "</td><td>" + this.signal + "</td><td>" + this.channel + "</td><td>" + this.address + "</td></tr>";
    });
    rightGraphData = new complexData(labels,"Channels",channels);
    $( rows ).appendTo( "#body-table" );
    ch1.destroy();
    ch2.destroy();


    ch1 = new Chart(chart1).PolarArea(leftGraphData);
    ch2 = new Chart(chart2).Bar(rightGraphData);
  }

  function loadBluetoothTable(){
    cleanTable();
    $('#head-table tr').append('<td>Device</td>')
    $('#head-table tr').append('<td>Address</td>')

     var rows = "";
    $.each(bluetoothData, function(){
    console.log(this);
    rows += "<tr><td>" + this.name + "</td><td>" +  this.address + "</td></tr>";
    });

    $( rows ).appendTo( "#body-table" );
    ch1.destroy();
    ch2.destroy();
    ch1 = new Chart(chart1).Pie(data);
    ch2 = new Chart(chart2).Line(data2);
  }

  function loadSwitchTable(){
    cleanTable();
    $('#head-table tr').append('<td>Type</td>')
    $('#head-table tr').append('<td>Mode</td>')

     var rows = "";
     var on = 0;
     var off = 0;
     leftGraphData.length = 0;
    $.each(switchData, function(){
    console.log(this);
    if(this.mode == 'on')
      on++;
    if(this.mode == 'off')
      off++;
    rows += "<tr><td>" + this.type + "</td><td>" +  this.mode + "</td></tr>";
    });

    leftGraphData.push(new simpleData(on,"on",colours[0]));
    leftGraphData.push(new simpleData(off,"off",colours[1]));

    $( rows ).appendTo( "#body-table" );
    ch1.destroy();
    ch2.destroy();
    ch1 = new Chart(chart1).Pie(leftGraphData);
    ch2 = new Chart(chart2).Line(data2);

  }

  function loadMotionTable(){
    cleanTable();
    $('#head-table tr').append('<td>Type</td>')
    $('#head-table tr').append('<td>Status</td>')

     var rows = "";
    $.each(testJson3.json.devices, function(){
    console.log(this);
    rows += "<tr><td>" + this.type + "</td><td>" +  this.status + "</td></tr>";
    });

    $( rows ).appendTo( "#body-table" );
    ch1.destroy();
    ch2.destroy();
    ch1 = new Chart(chart1).Pie(data);
    ch2 = new Chart(chart2).Line(data2);
  }

  function loadSMSTable(){
    cleanTable();
    $('#head-table tr').append('<td>Type</td>')
    $('#head-table tr').append('<td>From</td>')

     var rows = "";
    $.each(smsData, function(){
    console.log(this);
    rows += "<tr><td>" + this.type + "</td><td>" +  this.from + "</td></tr>";
    });

    $( rows ).appendTo( "#body-table" );
    ch1.destroy();
    ch2.destroy();
    ch1 = new Chart(chart1).Bar(data2);
    ch2 = new Chart(chart2).Line(data2);
  }

  function loadLocationTable(){
    cleanTable();
    $('#head-table tr').append('<td>Type</td>')
    $('#head-table tr').append('<td>Location</td>')

     var rows = "";
    $.each(testJson5.json.devices, function(){
    console.log(this);
    rows += "<tr><td>" + this.type + "</td><td>" +  this.location + "</td></tr>";
    });

    $( rows ).appendTo( "#body-table" );
    ch1.destroy();
    ch2.destroy();
    ch1 = new Chart(chart1).Pie(data);
    ch2 = new Chart(chart2).Line(data2);
  }

  function notifyIcon(){
    $('#notification').html('New Data!');
    console.log("it worked");
  }

  function refreshData(){
    
    $('#notification').html('Data is up to date.');
  }

  function refreshCurrentData(){
    console.log("refresh");
    switch(currentView){
      case 'rpi-wifi':break;
      case 'rpi-bt':break;
      case 'wemo-switch':break;
      case 'wemo-motion':break;
      case 'android-sms':break;
      case 'android-location':break;
      default:break;
    }
  }
    </script>
  </body>
</html>